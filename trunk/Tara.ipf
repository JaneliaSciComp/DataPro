#pragma rtGlobals=1		// Use modern global access method.#include "DP_Sampler"#include "DP_DigitizerModel"#include "DP_DigitizerView"#include "DP_DigitizerController"#include "DP_BrowserModel"#include "DP_BrowserView"#include "DP_BrowserController"#include "DP_Sweeper"#include "DP_SweeperView"#include "DP_SweeperController"#include "DP_TestPulser"#include "DP_SineBuilder"#include "DP_PSCBuilder"#include "DP_RampBuilder"#include "DP_TrainBuilder"#include "DP_StepBuilder"#include "DP_OutputViewer"#include "DP_Utilities"#include "DP_MyProcedures"#include "DP_BuilderModel"#include "DP_BuilderView"#include "DP_BuilderController"Menu "Tara"	"Switcher",SwitcherContConstructor()EndFunction SwitcherContConstructor()	SwitcherModelConstructor()	SwitcherViewConstructor()EndFunction SwitcherViewConstructor() : Graph	if (PanelExists("SwitcherView"))		DoWindow /F SwitcherView		return 0	endif	String savedDF=GetDataFolder(1)	SetDataFolder root:Switcher	Variable panelXOffset=720	Variable panelYOffset=54	Variable groupWidth=300	Variable groupHeight=60	Variable buttonWidth=90	Variable offButtonWidth=0.7*buttonWidth		// the off button is a.k.a. the unused button	Variable buttonHeight=25	Variable interButtonSpaceWidth=15	Variable interGroupSpaceHeight=8	Variable nAmplifiers=4	Variable panelWidth=320	Variable panelHeight=nAmplifiers*(groupHeight+interGroupSpaceHeight)	Variable ccButtonXOffset=(groupWidth-2*buttonWidth-2*interButtonSpaceWidth-offButtonWidth)/2	Variable textHeight=14	// Approimate height of text	Variable buttonYOffset=(groupHeight-buttonHeight-textHeight)/2+textHeight	Variable groupXOffset=(panelWidth-groupWidth)/2	Variable groupYOffset=interGroupSpaceHeight/2		NewPanel /W=(panelXOffset,panelYOffset,panelXOffset+panelWidth,panelYOffset+panelHeight) /K=1 /N=SwitcherView as "Switcher"	ModifyPanel /W=SwitcherView fixedSize=1	GroupBox amp1Group,win=SwitcherView,pos={groupXOffset,groupYOffset},size={groupWidth,groupHeight},title="Amplifier 1"	Button amplifier1CCButton,win=SwitcherView,pos={groupXOffset+ccButtonXOffset,groupYOffset+buttonYOffset},size={buttonWidth,buttonHeight},proc=SwitcherContButton,title="Current Clamp"	Button amplifier1VCButton,win=SwitcherView,pos={groupXOffset+ccButtonXOffset+buttonWidth+interButtonSpaceWidth,groupYOffset+buttonYOffset},size={buttonWidth,buttonHeight},proc=SwitcherContButton,title="Voltage Clamp"	Button amplifier1UnusedButton,win=SwitcherView,pos={groupXOffset+ccButtonXOffset+2*(buttonWidth+interButtonSpaceWidth),groupYOffset+buttonYOffset},size={offButtonWidth,buttonHeight},proc=SwitcherContButton,title="Unused"	groupYOffset+=groupHeight+interGroupSpaceHeight	GroupBox amp2Group,win=SwitcherView,pos={groupXOffset,groupYOffset},size={groupWidth,groupHeight},title="Amplifier 2"	Button amplifier2CCButton,win=SwitcherView,pos={groupXOffset+ccButtonXOffset,groupYOffset+buttonYOffset},size={buttonWidth,buttonHeight},proc=SwitcherContButton,title="Current Clamp"	Button amplifier2VCButton,win=SwitcherView,pos={groupXOffset+ccButtonXOffset+buttonWidth+interButtonSpaceWidth,groupYOffset+buttonYOffset},size={buttonWidth,buttonHeight},proc=SwitcherContButton,title="Voltage Clamp"	Button amplifier2UnusedButton,win=SwitcherView,pos={groupXOffset+ccButtonXOffset+2*(buttonWidth+interButtonSpaceWidth),groupYOffset+buttonYOffset},size={offButtonWidth,buttonHeight},proc=SwitcherContButton,title="Unused"		groupYOffset+=groupHeight+interGroupSpaceHeight	GroupBox amp3Group,win=SwitcherView,pos={groupXOffset,groupYOffset},size={groupWidth,groupHeight},title="Amplifier 3"	Button amplifier3CCButton,win=SwitcherView,pos={groupXOffset+ccButtonXOffset,groupYOffset+buttonYOffset},size={buttonWidth,buttonHeight},proc=SwitcherContButton,title="Current Clamp"	Button amplifier3VCButton,win=SwitcherView,pos={groupXOffset+ccButtonXOffset+buttonWidth+interButtonSpaceWidth,groupYOffset+buttonYOffset},size={buttonWidth,buttonHeight},proc=SwitcherContButton,title="Voltage Clamp"	Button amplifier3UnusedButton,win=SwitcherView,pos={groupXOffset+ccButtonXOffset+2*(buttonWidth+interButtonSpaceWidth),groupYOffset+buttonYOffset},size={offButtonWidth,buttonHeight},proc=SwitcherContButton,title="Unused"	groupYOffset+=groupHeight+interGroupSpaceHeight	GroupBox amp4Group,win=SwitcherView,pos={groupXOffset,groupYOffset},size={groupWidth,groupHeight},title="Amplifier 4"	Button amplifier4CCButton,win=SwitcherView,pos={groupXOffset+ccButtonXOffset,groupYOffset+buttonYOffset},size={buttonWidth,buttonHeight},proc=SwitcherContButton,title="Current Clamp"	Button amplifier4VCButton,win=SwitcherView,pos={groupXOffset+ccButtonXOffset+buttonWidth+interButtonSpaceWidth,groupYOffset+buttonYOffset},size={buttonWidth,buttonHeight},proc=SwitcherContButton,title="Voltage Clamp"	Button amplifier4UnusedButton,win=SwitcherView,pos={groupXOffset+ccButtonXOffset+2*(buttonWidth+interButtonSpaceWidth),groupYOffset+buttonYOffset},size={offButtonWidth,buttonHeight},proc=SwitcherContButton,title="Unused"	SwitcherViewModelChanged()		SetDataFolder savedDF	EndFunction SwitcherModelConstructor()	// Construct the model	// if the DF already exists, nothing to do	if (DataFolderExists("root:Switcher"))		return 0		// have to return something	endif	// Save the current DF	String savedDF=GetDataFolder(1)		// Create a new DF	NewDataFolder /S root:Switcher	// Restore the original data folder	SetDataFolder savedDFEndFunction SwitcherViewModelChanged()EndFunction SwitcherContButton(controlName) : ButtonControl	String controlName	// Figure out CC vs VC, and the amplifier number, from the button control name	String regExp="^amplifier(.)(.*)Button$"	String amplifierIndexAsString, VorCString	SplitString /E=(regExp) controlName, amplifierIndexAsString, VorCString	Variable amplifierIndex=str2num(amplifierIndexAsString)	Variable isCC=AreStringsEqual(VorCString,"CC")	Variable isVC=AreStringsEqual(VorCString,"VC")	Variable isUnused=AreStringsEqual(VorCString,"Unused")	// Set the DAC channel appropriately	Variable dacIndex=amplifierIndex-1	// Determine the ADC channel used for recording voltage for this amp	Variable adcIndexCurrent=2*(amplifierIndex-1)	// Determine the ADC channel used for recording current for this amp	Variable adcIndexVoltage=adcIndexCurrent+1	if (isCC)		SweeperContSetDACChannelOn(dacIndex,1)		DigitizerContSetDACModeName(dacIndex,"Current")		SweeperContSetADCChannelOn(adcIndexVoltage,1)	// Turn channels on before off, b/c can't turn all channels off		DigitizerContSetADCModeName(adcIndexVoltage,"Voltage")		SweeperContSetADCChannelOn(adcIndexCurrent,0)	elseif (isVC)		SweeperContSetDACChannelOn(dacIndex,1)		DigitizerContSetDACModeName(dacIndex,"Voltage")		SweeperContSetADCChannelOn(adcIndexCurrent,1)		DigitizerContSetADCModeName(adcIndexCurrent,"Current")		SweeperContSetADCChannelOn(adcIndexVoltage,0)	elseif (isUnused)		SweeperContSetDACChannelOn(dacIndex,0)		SweeperContSetADCChannelOn(adcIndexCurrent,0)		SweeperContSetADCChannelOn(adcIndexVoltage,0)	endifEnd